<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>æ•™ä½ ä»å†™ä¸€ä¸ªè¿·ä½ koa-routeråˆ°é˜…è¯»koa-routeræºç  | ä¸ªäººä¸»é¡µ</title>
    <meta name="description" content="ä¸€ä¸ªäº’è”ç½‘å…¨æ‰å¦¹å­ï¼Œä¼šè®¾è®¡ï¼Œä¼šå‰ç«¯ï¼Œä¼šåç«¯ï¼Œè¿˜ä¼šè§†é¢‘åŠ¨æ•ˆï¼Œå¥½åƒå¹¶æ²¡æœ‰ä»€ä¹ˆåµç”¨ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚">
    
    
    <link rel="preload" href="/blog/assets/css/styles.b8f6f876.css" as="style"><link rel="preload" href="/blog/assets/js/app.b8f6f876.js" as="script"><link rel="preload" href="/blog/assets/js/22.4efd32d6.js" as="script"><link rel="prefetch" href="/blog/assets/css/1.styles.8e8fe409.css"><link rel="prefetch" href="/blog/assets/css/2.styles.a2bd3099.css"><link rel="prefetch" href="/blog/assets/js/1.8e8fe409.js"><link rel="prefetch" href="/blog/assets/js/10.619c7997.js"><link rel="prefetch" href="/blog/assets/js/11.9c3e970b.js"><link rel="prefetch" href="/blog/assets/js/12.531cd467.js"><link rel="prefetch" href="/blog/assets/js/13.7e326423.js"><link rel="prefetch" href="/blog/assets/js/14.f3b097e0.js"><link rel="prefetch" href="/blog/assets/js/15.6a2e75f0.js"><link rel="prefetch" href="/blog/assets/js/16.c206d890.js"><link rel="prefetch" href="/blog/assets/js/17.cff55b68.js"><link rel="prefetch" href="/blog/assets/js/18.cbfbf9aa.js"><link rel="prefetch" href="/blog/assets/js/19.96969ef1.js"><link rel="prefetch" href="/blog/assets/js/2.a2bd3099.js"><link rel="prefetch" href="/blog/assets/js/20.357307bb.js"><link rel="prefetch" href="/blog/assets/js/21.69c3455f.js"><link rel="prefetch" href="/blog/assets/js/23.f297491c.js"><link rel="prefetch" href="/blog/assets/js/24.cc9b4c20.js"><link rel="prefetch" href="/blog/assets/js/25.ee8d1b0e.js"><link rel="prefetch" href="/blog/assets/js/26.762d7fbf.js"><link rel="prefetch" href="/blog/assets/js/27.3a122b7f.js"><link rel="prefetch" href="/blog/assets/js/28.2175adc1.js"><link rel="prefetch" href="/blog/assets/js/29.ebb9d56c.js"><link rel="prefetch" href="/blog/assets/js/3.7e0f7a9a.js"><link rel="prefetch" href="/blog/assets/js/30.73a02a6b.js"><link rel="prefetch" href="/blog/assets/js/31.1eae61bd.js"><link rel="prefetch" href="/blog/assets/js/32.c07b58b2.js"><link rel="prefetch" href="/blog/assets/js/33.397eaa54.js"><link rel="prefetch" href="/blog/assets/js/34.51ce988a.js"><link rel="prefetch" href="/blog/assets/js/35.58456503.js"><link rel="prefetch" href="/blog/assets/js/36.608991b7.js"><link rel="prefetch" href="/blog/assets/js/4.66ec0ecb.js"><link rel="prefetch" href="/blog/assets/js/5.38cc5d58.js"><link rel="prefetch" href="/blog/assets/js/6.ce65520e.js"><link rel="prefetch" href="/blog/assets/js/7.705c84c4.js"><link rel="prefetch" href="/blog/assets/js/8.95f0bebe.js"><link rel="prefetch" href="/blog/assets/js/9.291ac53a.js">
    <link rel="stylesheet" href="/blog/assets/css/1.styles.8e8fe409.css"><link rel="stylesheet" href="/blog/assets/css/2.styles.a2bd3099.css"><link rel="stylesheet" href="/blog/assets/css/styles.b8f6f876.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/blog/" class="home-link router-link-active"><!----> <span class="site-name">ä¸ªäººä¸»é¡µ</span></a> <div class="links" style="max-width:nullpx;"><!----> <nav class="nav-links can-hide"><div class="nav-item"><a href="/blog/" class="nav-link">ä¸»é¡µ</a></div><div class="nav-item"><a href="/blog/home/" class="nav-link">vueæºç è§£è¯»</a></div><div class="nav-item"><a href="/blog/webpack/" class="nav-link">webpackæºç è§£è¯»</a></div><div class="nav-item"><a href="/blog/node/" class="nav-link router-link-active">koaæºç è§£æ</a></div><div class="nav-item"><a href="/blog/base/" class="nav-link">JSåŸºç¡€</a></div><div class="nav-item"><a href="/blog/source/" class="nav-link">å…¶ä»–</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">åšæ–‡</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/interview/" class="nav-link">é¢è¯•é¢˜</a></li><li class="dropdown-item"><!----> <a href="/blog/essay/" class="nav-link">éšæƒ³</a></li><li class="dropdown-item"><!----> <a href="https://saintgirl.zcool.com.cn" target="_blank" rel="noopener noreferrer" class="nav-link external">
  è®¾è®¡
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div></div><div class="nav-item"><a href="https://github.com/Carrie999" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/blog/" class="nav-link">ä¸»é¡µ</a></div><div class="nav-item"><a href="/blog/home/" class="nav-link">vueæºç è§£è¯»</a></div><div class="nav-item"><a href="/blog/webpack/" class="nav-link">webpackæºç è§£è¯»</a></div><div class="nav-item"><a href="/blog/node/" class="nav-link router-link-active">koaæºç è§£æ</a></div><div class="nav-item"><a href="/blog/base/" class="nav-link">JSåŸºç¡€</a></div><div class="nav-item"><a href="/blog/source/" class="nav-link">å…¶ä»–</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">åšæ–‡</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/interview/" class="nav-link">é¢è¯•é¢˜</a></li><li class="dropdown-item"><!----> <a href="/blog/essay/" class="nav-link">éšæƒ³</a></li><li class="dropdown-item"><!----> <a href="https://saintgirl.zcool.com.cn" target="_blank" rel="noopener noreferrer" class="nav-link external">
  è®¾è®¡
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div></div><div class="nav-item"><a href="https://github.com/Carrie999" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><div class="sidebar-group first"><p class="sidebar-heading open"><span>koaæºç è§£æ</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/blog/node/" class="sidebar-link">Koaæºç é˜…è¯»-ä¸­é—´ä»¶åŸç†åˆ†æ</a></li><li><a href="/blog/node/koa.html" class="sidebar-link">Koaæºç é˜…è¯»-è¯¦è§£</a></li><li><a href="/blog/node/koa-router.html" class="active sidebar-link">æ•™ä½ ä»å†™ä¸€ä¸ªè¿·ä½ koa-routeråˆ°é˜…è¯»koa-routeræºç </a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/node/koa-router.html#æœ€æ ¸å¿ƒéœ€æ±‚-è·¯ç”±åŒ¹é…" class="sidebar-link">æœ€æ ¸å¿ƒéœ€æ±‚-è·¯ç”±åŒ¹é…</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/node/koa-router.html#å…ˆåˆ†æ" class="sidebar-link">å…ˆåˆ†æ</a></li></ul></li><li class="sidebar-sub-header"><a href="/blog/node/koa-router.html#è¯»æºç " class="sidebar-link">è¯»æºç </a></li><li class="sidebar-sub-header"><a href="/blog/node/koa-router.html#éœ€æ±‚å®ç°" class="sidebar-link">éœ€æ±‚å®ç°</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/node/koa-router.html#å®ç°åŒ¹é…" class="sidebar-link">å®ç°åŒ¹é…</a></li><li class="sidebar-sub-header"><a href="/blog/node/koa-router.html#å†™æ³•çš„å¤šæ ·æ€§" class="sidebar-link">å†™æ³•çš„å¤šæ ·æ€§</a></li><li class="sidebar-sub-header"><a href="/blog/node/koa-router.html#æ”¯æŒä¸­é—´ä»¶" class="sidebar-link">æ”¯æŒä¸­é—´ä»¶</a></li><li class="sidebar-sub-header"><a href="/blog/node/koa-router.html#å¤šå±‚åµŒå¥—" class="sidebar-link">å¤šå±‚åµŒå¥—</a></li><li class="sidebar-sub-header"><a href="/blog/node/koa-router.html#è·¯å¾„å‰ç¼€ï¼ˆrouter-prefixesï¼‰" class="sidebar-link">è·¯å¾„å‰ç¼€ï¼ˆRouter prefixesï¼‰</a></li><li class="sidebar-sub-header"><a href="/blog/node/koa-router.html#url-parameters" class="sidebar-link">URL parameters</a></li></ul></li><li class="sidebar-sub-header"><a href="/blog/node/koa-router.html#router-js" class="sidebar-link">router.js</a></li><li class="sidebar-sub-header"><a href="/blog/node/koa-router.html#param" class="sidebar-link">param</a></li><li class="sidebar-sub-header"><a href="/blog/node/koa-router.html#params" class="sidebar-link">params</a></li><li class="sidebar-sub-header"><a href="/blog/node/koa-router.html#å°¾å£°" class="sidebar-link">å°¾å£°</a></li></ul></li></ul></div></li></ul> </div> <div class="page"> <div class="content"><p></p><div class="table-of-contents"><ul><li><a href="#æœ€æ ¸å¿ƒéœ€æ±‚-è·¯ç”±åŒ¹é…">æœ€æ ¸å¿ƒéœ€æ±‚-è·¯ç”±åŒ¹é…</a><ul><li><a href="#å…ˆåˆ†æ">å…ˆåˆ†æ</a></li></ul></li><li><a href="#è¯»æºç ">è¯»æºç </a></li><li><a href="#éœ€æ±‚å®ç°">éœ€æ±‚å®ç°</a><ul><li><a href="#å®ç°åŒ¹é…">å®ç°åŒ¹é…</a></li><li><a href="#å†™æ³•çš„å¤šæ ·æ€§">å†™æ³•çš„å¤šæ ·æ€§</a></li><li><a href="#æ”¯æŒä¸­é—´ä»¶">æ”¯æŒä¸­é—´ä»¶</a></li><li><a href="#å¤šå±‚åµŒå¥—">å¤šå±‚åµŒå¥—</a></li><li><a href="#è·¯å¾„å‰ç¼€ï¼ˆrouter-prefixesï¼‰">è·¯å¾„å‰ç¼€ï¼ˆRouter prefixesï¼‰</a></li><li><a href="#url-parameters">URL parameters</a></li></ul></li><li><a href="#router-js">router.js</a></li><li><a href="#param">param</a></li><li><a href="#params">params</a></li><li><a href="#å°¾å£°">å°¾å£°</a></li></ul></div><p></p> <h1 id="æ•™ä½ ä»å†™ä¸€ä¸ªè¿·ä½ koa-routeråˆ°é˜…è¯»koa-routeræºç "><a href="#æ•™ä½ ä»å†™ä¸€ä¸ªè¿·ä½ koa-routeråˆ°é˜…è¯»koa-routeræºç " aria-hidden="true" class="header-anchor">#</a> æ•™ä½ ä»å†™ä¸€ä¸ªè¿·ä½ koa-routeråˆ°é˜…è¯»koa-routeræºç </h1> <p>æœ¬æ‰“ç®—æ•™ä¸€æ­¥æ­¥å®ç°koa-routerï¼Œå› ä¸ºè¦è§£é‡Šçš„å¤ªå¤šäº†ï¼Œæ‰€ä»¥å…ˆç®€åŒ–æˆminiç‰ˆæœ¬ï¼Œä»å®ç°éƒ¨åˆ†åŠŸèƒ½åˆ°é˜…è¯»æºç ï¼Œå¸Œæœ›èƒ½è®©ä½ å¥½ç†è§£ä¸€äº›ã€‚
å¸Œæœ›ä½ ä¹‹å‰æœ‰è¯»è¿‡koaæºç ï¼Œæ²¡æœ‰çš„è¯ï¼Œç»™ä½ <a href="https://carrie999.github.io/blog/node/" target="_blank" rel="noopener noreferrer">é“¾æ¥<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h2 id="æœ€æ ¸å¿ƒéœ€æ±‚-è·¯ç”±åŒ¹é…"><a href="#æœ€æ ¸å¿ƒéœ€æ±‚-è·¯ç”±åŒ¹é…" aria-hidden="true" class="header-anchor">#</a> æœ€æ ¸å¿ƒéœ€æ±‚-è·¯ç”±åŒ¹é…</h2> <p>routeræœ€é‡è¦çš„å°±æ˜¯è·¯ç”±åŒ¹é…ï¼Œæˆ‘ä»¬å°±ä»æœ€æ ¸å¿ƒçš„å…¥æ‰‹</p> <div class="language-js extra-class"><pre class="language-js"><code>router<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">'/string'</span><span class="token punctuation">,</span><span class="token keyword">async</span> <span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> next<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  ctx<span class="token punctuation">.</span>body <span class="token operator">=</span> <span class="token string">'koa2 string'</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

router<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">'/json'</span><span class="token punctuation">,</span><span class="token keyword">async</span> <span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> next<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  ctx<span class="token punctuation">.</span>body <span class="token operator">=</span> <span class="token string">'koa2 json'</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>æˆ‘ä»¬å¸Œæœ›</p> <ul><li>è·¯å¾„è®¿é—® /string é¡µé¢æ˜¾ç¤º 'koa2 string'</li> <li>è·¯å¾„è®¿é—® /json é¡µé¢æ˜¾ç¤º 'koa2 json'</li></ul> <h3 id="å…ˆåˆ†æ"><a href="#å…ˆåˆ†æ" aria-hidden="true" class="header-anchor">#</a> å…ˆåˆ†æ</h3> <h5 id="æ”¶é›†å¼€å‘è€…è¾“å…¥çš„ä¿¡æ¯é…ç½®"><a href="#æ”¶é›†å¼€å‘è€…è¾“å…¥çš„ä¿¡æ¯é…ç½®" aria-hidden="true" class="header-anchor">#</a> æ”¶é›†å¼€å‘è€…è¾“å…¥çš„ä¿¡æ¯é…ç½®</h5> <p>1.æˆ‘ä»¬éœ€è¦ä¸€ä¸ªæ•°ç»„ï¼Œæ•°ç»„é‡Œæ¯ä¸ªéƒ½æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œæ¯ä¸ªå¯¹è±¡åŒ…å«è·¯å¾„ï¼Œæ–¹æ³•ï¼Œå‡½æ•°ï¼Œä¼ å‚ç­‰ä¿¡æ¯
è¿™ä¸ªæ•°ç»„æˆ‘ä»¬èµ·ä¸ªåå­—å«stack</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> stack <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
</code></pre></div><p>2.å¯¹äºæ¯ä¸€ä¸ªå¯¹è±¡ï¼Œæˆ‘ä»¬èµ·åå«layer
æˆ‘ä»¬æŠŠå®ƒå®šä¹‰æˆä¸€ä¸ªå‡½æ•°</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">Layer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    
<span class="token punctuation">}</span>
</code></pre></div><p>æˆ‘ä»¬æŠŠé¡µé¢æ¯”å–»æˆä¸€ä¸ªç®±å­ï¼Œç®±å­æ˜¯å¯¹å¤–çš„ï¼Œç®±å­éœ€è¦æœ‰å…¥å£ï¼Œéœ€è¦å®¹çº³ã€‚æŠŠæ¯ä¸€ä¸ªrouteræ¯”ä½œæ”¾åœ¨ç®±å­é‡Œçš„ç‰©ä»¶ï¼Œç‰©ä»¶æ˜¯å†…éƒ¨çš„</p> <p>å®šä¹‰ä¸¤ä¸ªjsé¡µé¢ï¼Œrouter.jsåšä¸ºå…¥å£ï¼Œå¯¹äºå½“å‰é¡µé¢çš„è®¿é—®çš„å¤„ç†ï¼Œlayer.jsåŒ…å«å¼€å‘è€…å·²ç»çº¦å®šå¥½çš„è§„åˆ™</p> <p>router.js</p> <div class="language- extra-class"><pre class="language-text"><code>module.exports = Router;

function Router(opts) {
  // å®¹çº³layerå±‚
  this.stack = [];
};
</code></pre></div><p>layer.js</p> <div class="language- extra-class"><pre class="language-text"><code>module.exports = Layer;

function Layer() {

};
</code></pre></div><p>æˆ‘ä»¬åœ¨Routerè¦æ”¾ä¸Šè®¸å¤šæ–¹æ³•ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨Routerå†…éƒ¨æŒ‚è½½æ–¹æ³•ï¼Œä¹Ÿå¯ä»¥åœ¨åŸå‹ä¸ŠæŒ‚è½½å‡½æ•°</p> <p>ä½†æ˜¯è¦è€ƒè™‘å¤šå¯èƒ½Routerè¦è¢«å¤šæ¬¡å®ä¾‹åŒ–ï¼Œè¿™æ ·é‡Œé¢éƒ½è¦å¼€è¾Ÿä¸€ä»½æ–°çš„ç©ºé—´ï¼ŒæŒ‚è½½åœ¨åŸå‹å°±æ˜¯åŒä¸€ä»½ç©ºé—´ã€‚
æœ€ç»ˆå†³å®šæŒ‚è½½åœ¨åŸå‹ä¸Š</p> <p>æ–¹æ³•æœ‰å¾ˆå¤šï¼Œæˆ‘ä»¬å…ˆå®ç°çº¦å®šå‡ ä¸ªå¸¸ç”¨çš„å§</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> methods <span class="token operator">=</span> <span class="token punctuation">[</span>
  <span class="token string">'get'</span><span class="token punctuation">,</span>
  <span class="token string">'post'</span><span class="token punctuation">,</span>
  <span class="token string">'put'</span><span class="token punctuation">,</span>
  <span class="token string">'head'</span><span class="token punctuation">,</span>
  <span class="token string">'delete'</span><span class="token punctuation">,</span>
  <span class="token string">'options'</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code>methods<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>method<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  Router<span class="token punctuation">.</span>prototype<span class="token punctuation">[</span>method<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span>middleware<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token comment">// å¯¹äºpath,middlewareï¼Œæˆ‘ä»¬éœ€è¦æŠŠå®ƒäº¤ç»™layerï¼Œæ‹¿åˆ°layerè¿”å›çš„ç»“æœ</span>
    <span class="token comment">// è¿™é‡Œäº¤ç»™å¦ä¸€ä¸ªå‡½æ•°æ¥æ˜¯å®ç°ï¼Œæˆ‘ä»¬å«å®ƒregisterå°±æ˜¯æš‚å­˜çš„æ„æ€</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span> <span class="token punctuation">[</span>method<span class="token punctuation">]</span><span class="token punctuation">,</span> middleware<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// å› ä¸ºgetè¿˜å¯ä»¥ç»§ç»­getï¼Œæˆ‘ä»¬è¿”å›this</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="å®ç°layerçš„æ²Ÿé€š"><a href="#å®ç°layerçš„æ²Ÿé€š" aria-hidden="true" class="header-anchor">#</a> å®ç°layerçš„æ²Ÿé€š</h4> <div class="language-js extra-class"><pre class="language-js"><code>Router<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">register</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>path<span class="token punctuation">,</span> methods<span class="token punctuation">,</span> middleware<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> stack <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>stack<span class="token punctuation">;</span>
  <span class="token keyword">let</span> route <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Layer</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span> methods<span class="token punctuation">,</span> middleware<span class="token punctuation">)</span><span class="token punctuation">;</span>
  stack<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>route<span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token keyword">return</span> route
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>è¿™é‡Œæˆ‘ä»¬å…ˆå»å†™layer</p> <div class="language-js extra-class"><pre class="language-js"><code>
<span class="token keyword">const</span> pathToRegExp <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path-to-regexp'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">Layer</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span> methods<span class="token punctuation">,</span> middleware<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// æŠŠæ–¹æ³•åç§°æ”¾åˆ°methodsæ•°ç»„é‡Œ</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>methods <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token comment">// stackç››æ”¾ä¸­é—´ä»¶å‡½æ•°</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>stack <span class="token operator">=</span> Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>middleware<span class="token punctuation">)</span> <span class="token operator">?</span> middleware <span class="token punctuation">:</span> <span class="token punctuation">[</span>middleware<span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token comment">// è·¯å¾„</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>path <span class="token operator">=</span> path<span class="token punctuation">;</span>
  <span class="token comment">// å¯¹äºè¿™ä¸ªè·¯å¾„ç”ŸæˆåŒ¹é…è§„åˆ™ï¼Œè¿™é‡Œå€ŸåŠ©ç¬¬ä¸‰æ–¹</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>regexp <span class="token operator">=</span> <span class="token function">pathToRegExp</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// methods</span>
  methods<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>method<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>methods<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>method<span class="token punctuation">.</span><span class="token function">toUpperCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// ç»‘å®šlayerçš„thisï¼Œä¸ç„¶åŒ¿åå‡½æ•°çš„thisæŒ‡å‘window</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">// ç»™ä¸€ä¸ªåŸå‹æ–¹æ³•matchåŒ¹é…è¿”å›true</span>
Layer<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">match</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>path<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>regexp<span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>å›åˆ°routerå±‚</p> <p>å®šä¹‰matchæ–¹æ³•,æ ¹æ®Developerä¼ å…¥çš„path, methodè¿”å› ä¸€ä¸ªå¯¹è±¡(åŒ…æ‹¬æ˜¯å¦åŒ¹é…ï¼ŒåŒ¹é…æˆåŠŸlayerï¼Œå’ŒåŒ¹é…æˆåŠŸçš„æ–¹æ³•)</p> <div class="language-js extra-class"><pre class="language-js"><code>Router<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">match</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>path<span class="token punctuation">,</span> method<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> layers <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>stack<span class="token punctuation">;</span>
  <span class="token keyword">let</span> layer<span class="token punctuation">;</span>
  <span class="token keyword">const</span> matched <span class="token operator">=</span> <span class="token punctuation">{</span>
    path<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    pathAndMethod<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    route<span class="token punctuation">:</span> <span class="token boolean">false</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
   <span class="token comment">//å¾ªç¯å¯„å­˜å¥½çš„stackå±‚çš„æ¯ä¸€ä¸ªlayer</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> len <span class="token operator">=</span> layers<span class="token punctuation">.</span>length<span class="token punctuation">,</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> len<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    layer <span class="token operator">=</span> layers<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>

    <span class="token comment">//layeræ˜¯æå‰å­˜å¥½çš„è·¯å¾„ï¼Œ pathæ˜¯è¿‡æ¥çš„path</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>layer<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// layeræ”¾å…¥pathï¼Œä¸ºä»€ä¹ˆä¸æŠŠpathä¼ å…¥ï¼Œä¸€æ˜¯pathå·²ç»æ²¡ç”¨äº†ï¼ŒåŒ¹é…äº†å°±å¤Ÿäº†ï¼Œlayerå«æœ‰æ›´å¤šä¿¡æ¯éœ€è¦ç”¨</span>
      matched<span class="token punctuation">.</span>path<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>layer<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">//å¦‚æœmethodsä»€ä¹ˆä¹Ÿæ²¡å†™ï¼Œæˆ–è€…å¦‚æœæ–¹æ³•é‡Œå«æœ‰ä½ çš„è¿‡æ¥çš„æ–¹æ³•ï¼Œé‚£ä¹ˆæŠŠlayeræ”¾å…¥pathAndMethod</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>layer<span class="token punctuation">.</span>methods<span class="token punctuation">.</span>length <span class="token operator">===</span> <span class="token number">0</span> <span class="token operator">||</span> <span class="token operator">~</span>layer<span class="token punctuation">.</span>methods<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span>method<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        matched<span class="token punctuation">.</span>pathAndMethod<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>layer<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// è·¯å¾„åŒ¹é…ï¼Œå¹¶ä¸”æœ‰æ–¹æ³•</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>layer<span class="token punctuation">.</span>methods<span class="token punctuation">.</span>length<span class="token punctuation">)</span> matched<span class="token punctuation">.</span>route <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">return</span> matched<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

</code></pre></div><p>ç»™Developerä¸€ä¸ªæ–¹æ³•</p> <div class="language-js extra-class"><pre class="language-js"><code>app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>index<span class="token punctuation">.</span><span class="token function">routes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><p>è¿™é‡Œä¸è€ƒè™‘ä¼ å¤šä¸ªidï¼Œå’Œå¤šæ¬¡åŒ¹é…æƒ…å†µï¼Œæ‹¿åˆ°åŒ¹é…çš„å‡½æ•°</p> <div class="language-js extra-class"><pre class="language-js"><code>Router<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">routes</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">var</span> router <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> <span class="token function-variable function">dispatch</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token function">dispatch</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> next<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> path <span class="token operator">=</span> ctx<span class="token punctuation">.</span>path
    <span class="token keyword">const</span> method <span class="token operator">=</span> ctx<span class="token punctuation">.</span>method
    <span class="token keyword">const</span> matched <span class="token operator">=</span> router<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span> ctx<span class="token punctuation">.</span>method<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>matched<span class="token punctuation">.</span>route<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> matchedLayers <span class="token operator">=</span> matched<span class="token punctuation">.</span>pathAndMethod
    <span class="token comment">// å…ˆä¸è€ƒè™‘å¤šmatchedLayerså¤šstackæƒ…å†µ</span>
    <span class="token keyword">return</span> matchedLayers<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>stack<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> next<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">return</span> dispatch
<span class="token punctuation">}</span>
</code></pre></div><p>æ­¤æ—¶ä¸€ä¸ªè¿·ä½ koa-routerå·²ç»å®ç°äº†</p> <h2 id="è¯»æºç "><a href="#è¯»æºç " aria-hidden="true" class="header-anchor">#</a> è¯»æºç </h2> <h2 id="éœ€æ±‚å®ç°"><a href="#éœ€æ±‚å®ç°" aria-hidden="true" class="header-anchor">#</a> éœ€æ±‚å®ç°</h2> <h3 id="å®ç°åŒ¹é…"><a href="#å®ç°åŒ¹é…" aria-hidden="true" class="header-anchor">#</a> å®ç°åŒ¹é…</h3> <p>æ–¹æ³•ååŒ¹é…ï¼Œè·¯å¾„åŒ¹é…ï¼Œè¿˜è¦æ»¡è¶³åŠ¨æ€å‚æ•°çš„ä¼ é€’</p> <p>å¹¶ä¸”è¿˜è¦ç»™å¾ˆæ‡’çš„å¼€å‘è€…ä¸€ä¸ªrouter.all()
ä¹Ÿå°±æ˜¯è¯´ä¸ç”¨åŒºåˆ†æ–¹æ³•äº†ğŸ™„</p> <div class="language-js extra-class"><pre class="language-js"><code> router
    <span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> next<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          ctx<span class="token punctuation">.</span>body <span class="token operator">=</span> <span class="token string">'Hello World!'</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">'/users'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> next<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
         <span class="token comment">// ...</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">'/users/:id'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> next<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token comment">// ...</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">del</span><span class="token punctuation">(</span><span class="token string">'/users/:id'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> next<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token comment">// ...</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token string">'/users/:id'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> next<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token comment">// ...</span>
   <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="å†™æ³•çš„å¤šæ ·æ€§"><a href="#å†™æ³•çš„å¤šæ ·æ€§" aria-hidden="true" class="header-anchor">#</a> å†™æ³•çš„å¤šæ ·æ€§</h3> <p>ä¸ºäº†æ–¹ä¾¿ä¼—å¤šçš„å¼€å‘è€…ä½¿ç”¨</p> <div class="language-js extra-class"><pre class="language-js"><code>router<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">'user'</span><span class="token punctuation">,</span> <span class="token string">'/users/:id'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> next<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
 <span class="token comment">// ...</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 
router<span class="token punctuation">.</span><span class="token function">url</span><span class="token punctuation">(</span><span class="token string">'user'</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>å¦‚ä¸‹å†™æ³•
éƒ½æ˜¯ä¸€ä¸ªè·¯å¾„</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// =&gt; &quot;/users/3&quot;</span>
</code></pre></div><h3 id="æ”¯æŒä¸­é—´ä»¶"><a href="#æ”¯æŒä¸­é—´ä»¶" aria-hidden="true" class="header-anchor">#</a> æ”¯æŒä¸­é—´ä»¶</h3> <div class="language-js extra-class"><pre class="language-js"><code>router<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span>
    <span class="token string">'/users/:id'</span><span class="token punctuation">,</span>
    <span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> next<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> User<span class="token punctuation">.</span><span class="token function">findOne</span><span class="token punctuation">(</span>ctx<span class="token punctuation">.</span>params<span class="token punctuation">.</span>id<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span>  
            ctx<span class="token punctuation">.</span>user <span class="token operator">=</span> user<span class="token punctuation">;</span>
            <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    ctx <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>ctx<span class="token punctuation">.</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// =&gt; { id: 17, name: &quot;Alex&quot; }</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="å¤šå±‚åµŒå¥—"><a href="#å¤šå±‚åµŒå¥—" aria-hidden="true" class="header-anchor">#</a> å¤šå±‚åµŒå¥—</h3> <div class="language-js extra-class"><pre class="language-js"><code> <span class="token keyword">var</span> forums <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Router</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token keyword">var</span> posts <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Router</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 posts<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> next<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 posts<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">'/:pid'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> next<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 forums<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token string">'/forums/:fid/posts'</span><span class="token punctuation">,</span> posts<span class="token punctuation">.</span><span class="token function">routes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> posts<span class="token punctuation">.</span><span class="token function">allowedMethods</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token comment">//responds to &quot;/forums/123/posts&quot; and &quot;/forums/123/posts/123&quot;</span>
 app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>forums<span class="token punctuation">.</span><span class="token function">routes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="è·¯å¾„å‰ç¼€ï¼ˆrouter-prefixesï¼‰"><a href="#è·¯å¾„å‰ç¼€ï¼ˆrouter-prefixesï¼‰" aria-hidden="true" class="header-anchor">#</a> è·¯å¾„å‰ç¼€ï¼ˆRouter prefixesï¼‰</h3> <div class="language- extra-class"><pre class="language-text"><code>var router = new Router({
     prefix: '/users'
});
router.get('/', ...); 
// responds to &quot;/users&quot;
router.get('/:id', ...); 
// responds to &quot;/users/:id&quot;
</code></pre></div><h3 id="url-parameters"><a href="#url-parameters" aria-hidden="true" class="header-anchor">#</a> URL parameters</h3> <div class="language-js extra-class"><pre class="language-js"><code>router<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">'/:category/:title'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> next<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>ctx<span class="token punctuation">.</span>params<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// =&gt; { category: 'programming', title: 'how-to-node' }</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="router-js"><a href="#router-js" aria-hidden="true" class="header-anchor">#</a> router.js</h2> <div class="language-js extra-class"><pre class="language-js"><code>methods<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span>method<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  Router<span class="token punctuation">.</span>prototype<span class="token punctuation">[</span>method<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>name<span class="token punctuation">,</span> path<span class="token punctuation">,</span> middleware<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> middleware<span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> path <span class="token operator">===</span> <span class="token string">'string'</span> <span class="token operator">||</span> path <span class="token keyword">instanceof</span> <span class="token class-name">RegExp</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// ç¬¬äºŒä¸ªå‚æ•°æ˜¯å¦æ˜¯è·¯å¾„ï¼Œå¦‚æœæ˜¯è·¯å¾„å­—ç¬¦ä¸²é‚£ä¹ˆä»ä¸‹è¡¨[2]å¼€å§‹æ‰æ˜¯ä¸­é—´ä»¶</span>
      middleware <span class="token operator">=</span> Array<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>slice<span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>arguments<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      middleware <span class="token operator">=</span> Array<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>slice<span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>arguments<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      path <span class="token operator">=</span> name<span class="token punctuation">;</span>
      name <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span> <span class="token punctuation">[</span>method<span class="token punctuation">]</span><span class="token punctuation">,</span> middleware<span class="token punctuation">,</span> <span class="token punctuation">{</span>
      name<span class="token punctuation">:</span> name
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//åˆ«å</span>
Router<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>del <span class="token operator">=</span> Router<span class="token punctuation">.</span>prototype<span class="token punctuation">[</span><span class="token string">'delete'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre></div><p>methodså¼•ç”¨ç¬¬ä¸‰æ–¹åŒ…å«</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">getBasicNodeMethods</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">[</span>
    <span class="token string">'get'</span><span class="token punctuation">,</span>
    <span class="token string">'post'</span><span class="token punctuation">,</span>
    <span class="token string">'put'</span><span class="token punctuation">,</span>
    <span class="token string">'head'</span><span class="token punctuation">,</span>
    <span class="token string">'delete'</span><span class="token punctuation">,</span>
    <span class="token string">'options'</span><span class="token punctuation">,</span>
    <span class="token string">'trace'</span><span class="token punctuation">,</span>
    <span class="token string">'copy'</span><span class="token punctuation">,</span>
    <span class="token string">'lock'</span><span class="token punctuation">,</span>
    <span class="token string">'mkcol'</span><span class="token punctuation">,</span>
    <span class="token string">'move'</span><span class="token punctuation">,</span>
    <span class="token string">'purge'</span><span class="token punctuation">,</span>
    <span class="token string">'propfind'</span><span class="token punctuation">,</span>
    <span class="token string">'proppatch'</span><span class="token punctuation">,</span>
    <span class="token string">'unlock'</span><span class="token punctuation">,</span>
    <span class="token string">'report'</span><span class="token punctuation">,</span>
    <span class="token string">'mkactivity'</span><span class="token punctuation">,</span>
    <span class="token string">'checkout'</span><span class="token punctuation">,</span>
    <span class="token string">'merge'</span><span class="token punctuation">,</span>
    <span class="token string">'m-search'</span><span class="token punctuation">,</span>
    <span class="token string">'notify'</span><span class="token punctuation">,</span>
    <span class="token string">'subscribe'</span><span class="token punctuation">,</span>
    <span class="token string">'unsubscribe'</span><span class="token punctuation">,</span>
    <span class="token string">'patch'</span><span class="token punctuation">,</span>
    <span class="token string">'search'</span><span class="token punctuation">,</span>
    <span class="token string">'connect'</span>
  <span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code>Router<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>routes <span class="token operator">=</span> Router<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">middleware</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> router <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>

  <span class="token keyword">var</span> <span class="token function-variable function">dispatch</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token function">dispatch</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> next<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> path <span class="token operator">=</span> router<span class="token punctuation">.</span>opts<span class="token punctuation">.</span>routerPath <span class="token operator">||</span> ctx<span class="token punctuation">.</span>routerPath <span class="token operator">||</span> ctx<span class="token punctuation">.</span>path<span class="token punctuation">;</span>
    <span class="token keyword">var</span> matched <span class="token operator">=</span> router<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span> ctx<span class="token punctuation">.</span>method<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> layerChain<span class="token punctuation">,</span> layer<span class="token punctuation">,</span> i<span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>ctx<span class="token punctuation">.</span>matched<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      ctx<span class="token punctuation">.</span>matched<span class="token punctuation">.</span>push<span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>ctx<span class="token punctuation">.</span>matched<span class="token punctuation">,</span> matched<span class="token punctuation">.</span>path<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      ctx<span class="token punctuation">.</span>matched <span class="token operator">=</span> matched<span class="token punctuation">.</span>path<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// ctxæŒ‚è½½router</span>
    ctx<span class="token punctuation">.</span>router <span class="token operator">=</span> router<span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>matched<span class="token punctuation">.</span>route<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// æ‹¿åˆ°æ—¢åŒ¹é…åˆ°è·¯å¾„åˆåŒ¹é…åˆ°æ–¹æ³•çš„layer</span>
    <span class="token keyword">var</span> matchedLayers <span class="token operator">=</span> matched<span class="token punctuation">.</span>pathAndMethod
    <span class="token comment">// å–å‡ºæœ€åä¸€ä¸ªlayer</span>
    <span class="token keyword">var</span> mostSpecificLayer <span class="token operator">=</span> matchedLayers<span class="token punctuation">[</span>matchedLayers<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span>
    <span class="token comment">// æŒ‚è½½_matchedRouteå±æ€§</span>
    ctx<span class="token punctuation">.</span>_matchedRoute <span class="token operator">=</span> mostSpecificLayer<span class="token punctuation">.</span>path<span class="token punctuation">;</span>
    <span class="token comment">// å¦‚æœæœ‰name,æ—¢å¦‚ä¸‹å†™æ³•ä¼šæœ‰name, nameæ˜¯string</span>
    <span class="token comment">// router.get('/string','/string/:1',async (ctx, next) =&gt; {</span>
    <span class="token comment">//   ctx.body = 'koa2 string'</span>
    <span class="token comment">// })</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>mostSpecificLayer<span class="token punctuation">.</span>name<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// æŒ‚è½½_matchedRouteNameå±æ€§</span>
      ctx<span class="token punctuation">.</span>_matchedRouteName <span class="token operator">=</span> mostSpecificLayer<span class="token punctuation">.</span>name<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// layerChainå°±æ˜¯ä¸­é—´ä»¶æ•°ç»„ï¼Œç›®å‰æ˜¯ä¸¤ä¸ªå‡½æ•°</span>
    layerChain <span class="token operator">=</span> matchedLayers<span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>memo<span class="token punctuation">,</span> layer<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      memo<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> next<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        ctx<span class="token punctuation">.</span>captures <span class="token operator">=</span> layer<span class="token punctuation">.</span><span class="token function">captures</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span> ctx<span class="token punctuation">.</span>captures<span class="token punctuation">)</span><span class="token punctuation">;</span>
        ctx<span class="token punctuation">.</span>params <span class="token operator">=</span> layer<span class="token punctuation">.</span><span class="token function">params</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span> ctx<span class="token punctuation">.</span>captures<span class="token punctuation">,</span> ctx<span class="token punctuation">.</span>params<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// console.log('captures2', ctx.captures)</span>
        <span class="token comment">// ctx.capturesæ˜¯ :id çš„æ•æ‰ï¼Œæ­£åˆ™åŒ¹é…sliceæˆªå–å¾—åˆ°</span>
        <span class="token comment">// ctx.paramsæ˜¯å¯¹è±¡ {id:1}</span>
        ctx<span class="token punctuation">.</span>routerName <span class="token operator">=</span> layer<span class="token punctuation">.</span>name<span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> memo<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span>layer<span class="token punctuation">.</span>stack<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// ä¸­é—´ä»¶è°ƒç”¨layerChain</span>
    <span class="token keyword">return</span> <span class="token function">compose</span><span class="token punctuation">(</span>layerChain<span class="token punctuation">)</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> next<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token comment">// routesæŒ‚è½½routerå¯¹è±¡</span>
  dispatch<span class="token punctuation">.</span>router <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
  <span class="token comment">// æ¯æ¬¡è°ƒç”¨routesè¿”å›ä¸€ä¸ªdispatchå‡½æ•°(layer.stackå’Œmemo)ï¼Œå‡½æ•°è¿˜æœ‰ä¸€ä¸ªå±äºè¿™ä¸ªè·¯å¾„ä¸‹çš„routerå±æ€§å¯¹è±¡</span>
  <span class="token keyword">return</span> dispatch<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

</code></pre></div><p>è¿™é‡Œä½¿ç”¨compose-koaä¸­é—´ä»¶çš„æ–¹å¼æ¥å¤„ç†ä¼ é€’å¤šä¸ªå‡½æ•°å’Œå¤šç§åŒ¹é…çš„æƒ…å†µ
captureså’Œparams  å¤„ç†è‡ªå®šä¹‰è·¯å¾„ä¼ å‚</p> <h2 id="param"><a href="#param" aria-hidden="true" class="header-anchor">#</a> param</h2> <p>å®ç°å¦‚ä¸‹éœ€æ±‚ï¼Œè®¿é—®/users/:1
åœ¨paramä¸­èƒ½æ‹¿åˆ°user</p> <div class="language-js extra-class"><pre class="language-js"><code>router
  <span class="token punctuation">.</span><span class="token function">param</span><span class="token punctuation">(</span><span class="token string">'user'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>user<span class="token punctuation">,</span> ctx<span class="token punctuation">,</span> next<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    ctx<span class="token punctuation">.</span>user <span class="token operator">=</span> user<span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>ctx<span class="token punctuation">.</span>user<span class="token punctuation">)</span> <span class="token keyword">return</span> ctx<span class="token punctuation">.</span>status <span class="token operator">=</span> <span class="token number">404</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">'/users/:user'</span><span class="token punctuation">,</span> ctx <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    ctx<span class="token punctuation">.</span>body <span class="token operator">=</span> ctx<span class="token punctuation">.</span>user<span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code>Router<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">param</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>param<span class="token punctuation">,</span> middleware<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>params<span class="token punctuation">[</span>param<span class="token punctuation">]</span> <span class="token operator">=</span> middleware<span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>stack<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span>route<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    route<span class="token punctuation">.</span><span class="token function">param</span><span class="token punctuation">(</span>param<span class="token punctuation">,</span> middleware<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code>Layer<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">param</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>param<span class="token punctuation">,</span> fn<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> stack <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>stack<span class="token punctuation">;</span>
  <span class="token keyword">var</span> params <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>paramNames<span class="token punctuation">;</span>
  <span class="token keyword">var</span> <span class="token function-variable function">middleware</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> next<span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token comment">// ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ ctx.params[param], paramsæ‹¿åˆ°äº†user</span>
    <span class="token keyword">return</span> fn<span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> ctx<span class="token punctuation">.</span>params<span class="token punctuation">[</span>param<span class="token punctuation">]</span><span class="token punctuation">,</span> ctx<span class="token punctuation">,</span> next<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="params"><a href="#params" aria-hidden="true" class="header-anchor">#</a> params</h2> <p>å®ç°å¦‚ä¸‹éœ€æ±‚</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>router<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">'/:category/:title'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> next<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>ctx<span class="token punctuation">.</span>params<span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token comment">// =&gt; { category: 'programming', title: 'how-to-node' }</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>ä¾‹å­</p> <div class="language-js extra-class"><pre class="language-js"><code>router<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">'/string/:id'</span><span class="token punctuation">,</span><span class="token keyword">async</span> <span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> next<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  ctx<span class="token punctuation">.</span>body <span class="token operator">=</span> <span class="token string">'koa2 string'</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>è®¿é—®  string/1</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// æ‹¿åˆ°{id:1}</span>
ctx<span class="token punctuation">.</span>params <span class="token operator">=</span> layer<span class="token punctuation">.</span><span class="token function">params</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span> ctx<span class="token punctuation">.</span>captures<span class="token punctuation">,</span> ctx<span class="token punctuation">.</span>params<span class="token punctuation">)</span><span class="token punctuation">;</span>

  
Layer<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">params</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>path<span class="token punctuation">,</span> captures<span class="token punctuation">,</span> existingParams<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> params <span class="token operator">=</span> existingParams <span class="token operator">||</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> len <span class="token operator">=</span> captures<span class="token punctuation">.</span>length<span class="token punctuation">,</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">&lt;</span>len<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>paramNames<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">var</span> c <span class="token operator">=</span> captures<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
      <span class="token comment">// æ‰¾åˆ°nameèµ‹å€¼</span>
      params<span class="token punctuation">[</span><span class="token keyword">this</span><span class="token punctuation">.</span>paramNames<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>name<span class="token punctuation">]</span> <span class="token operator">=</span> c <span class="token operator">?</span> <span class="token function">safeDecodeURIComponent</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span> <span class="token punctuation">:</span> c<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// è¿”å›{id:1}</span>
  <span class="token keyword">return</span> params<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>æœ‰å…´è¶£çš„å¯ä»¥ç ”ç©¶ä¸€ä¸‹allowedMethodsï¼Œprefixï¼Œuseï¼Œredirectç­‰åŸå‹æ–¹æ³•ï¼Œè¿™é‡Œå·²ç»æŠŠæœ€æ ¸å¿ƒçš„å±•ç¤ºäº†ï¼Œè‡³æ­¤ï¼Œkoaæºç ç³»åˆ—è§£è¯»å®Œæ¯•ã€‚</p> <h2 id="å°¾å£°"><a href="#å°¾å£°" aria-hidden="true" class="header-anchor">#</a> å°¾å£°</h2> <p>ä»vueæºç è¯»åˆ°webpackå†åˆ°koaï¼Œæ·±æ„Ÿæºç æ¶æ„çš„æœ‰è¶£ï¼Œæ¯”åšä¸šåŠ¡æœ‰è¶£å¤ªå¤šï¼Œæœ‰æ„ä¹‰å¤ªå¤šã€‚
ä»¥åæºç é˜…è¯»åº”è¯¥ä¸ä¼šè®°å½•blogäº†ï¼Œè¿™æ ·å­¦èµ·æ¥å¤ªæ…¢äº†ã€‚å½“ç„¶ä¹Ÿä¼šç»§ç»­ç ”ç©¶æºç ã€‚
<br>
æˆ‘è§‰å¾—ç¨‹åºå‘˜ä¸åšå¼€æºä¸å»githubè´¡çŒ®æºç çš„äººç”Ÿæ˜¯æ²¡æœ‰æ„ä¹‰çš„ã€‚
<br>
ä¸æƒ³å½“å°†å†›çš„å£«å…µä¸æ˜¯å¥½å£«å…µã€‚
<br>
æ‰€ä»¥ä»¥åå¤§éƒ¨åˆ†æ—¶é—´ä¼šå»åšå¼€æºï¼Œè°¢è°¢é˜…è¯»ã€‚</p></div> <div class="page-edit"><!----> <!----></div> <div class="page-nav"><p class="inner"><span class="prev">
        â†
        <a href="/blog/node/koa.html" class="prev">
          Koaæºç é˜…è¯»-è¯¦è§£
        </a></span> <!----></p></div> </div> <!----></div></div>
    <script src="/blog/assets/js/22.4efd32d6.js" defer></script><script src="/blog/assets/js/app.b8f6f876.js" defer></script>
  </body>
</html>
